# 見積書作成における図面見積もりフロー実装戦略

## 背景・前提条件

### 従来システムの課題
**旧方式**: 図面詳細ページでの個別見積もり
- 問題点: 一つの見積もり完了後、次の図面見積もりのためにページ遷移が必要
- 効率性の低下: 複数図面を扱う場合の作業フローが煩雑
- UX課題: 見積もり作業の連続性が損なわれる

**新方式**: 見積書作成ページでのDialog方式
- 解決策: 見積書作成フロー内でDialogによる見積もり作業
- 効率向上: ページ遷移なしで複数図面の見積もりが可能
- 一貫性: 見積書作成という目的に沿った直線的なフロー

### ユーザープロファイル
- 中小企業の製造業従事者
- 顧客から複数の図面を受け取り見積もりを作成する業務
- OCR技術により図面データが自動抽出される環境
- 過去の類似図面を参考にした効率的な見積もり作業を求める

### システム前提
- 図面は取り込み時点でOCRによりデータ化済み
- 過去データとの類似性検索機能あり
- 図面登録→見積もり→見積書作成の一連のフローを管理

## ユーザーフロー詳細

### 1. 案件準備フェーズ
1. **新規案件作成**
   - 顧客情報、案件基本情報の入力
   - 案件IDの生成

2. **図面登録**
   - 複数図面のアップロード・登録
   - OCRによる自動データ抽出
   - 図面一覧での管理

### 2. 見積書作成フェーズ
1. **Step1: 案件情報入力**
   - 取引先、見積書番号、発行日、有効期限
   - 備考事項の入力

2. **Step2: 図面見積もり**
   - 登録済み図面の一覧表示
   - 各図面に対する「見積もるボタン」
   - モーダルでの個別見積もり作業
   - 過去類似図面の参考表示
   - 全図面の見積もり完了が必須

3. **Step3: 自社情報確認**
   - 会社情報、連絡先の確認・修正
   - ロゴ・印影の設定

### 3. 完了・保存フェーズ
- 保存ボタン押下
- 見積もりステータス「完了」への更新
- Toast通知での完了確認

## 技術実装要件

### 現在のコンポーネント構成
- `QuotationContainer`: メインコンテナ（StepIndicator + 各Step）
- `QuotationProjectInfoStep`: Step1（案件情報）
- `QuotationBlueprintInfoStep`: Step2（図面見積もり）← **大幅変更対象**
- `QuotationCompanyInfoStep`: Step3（自社情報）

### Step2変更要件
1. **従来**: 明細テーブル（品名、単価、数量等の直接入力）
2. **新規**: 図面一覧 + 個別見積もりモーダル

### 必要な新規実装
1. **図面データ構造**
   - 図面ID、ファイル名、OCRデータ、見積もり状況
   - 類似図面情報、参考価格データ

2. **図面一覧コンポーネント**
   - カード形式での図面表示
   - 見積もり状況の視覚的表示
   - 「見積もる」ボタン配置

3. **見積もりモーダル**
   - 図面詳細表示
   - 品名、単価、数量等の入力フォーム
   - 類似図面参考情報の表示
   - 保存・キャンセル機能

4. **データ管理**
   - FormDataの拡張（図面情報の組み込み）
   - 見積もり完了状況の管理
   - 明細データの図面別管理

## 実装優先度

### Phase 1: データ構造・ダミーデータ
- 図面データ型定義
- ダミー図面データ作成
- FormDataの拡張

### Phase 2: UI実装
- 図面一覧表示
- 見積もりモーダル
- 進捗状況表示

### Phase 3: 機能統合
- データフロー統合
- 保存・完了処理
- Toast通知

## 既存コードとの連携
- ResizableLayoutの維持
- StepIndicatorとの連携
- 既存のFormData構造の拡張
- QuotationPreviewとの連携（明細表示方法の調整）

このフローにより、製造業の実際の業務フローに沿った直感的な見積もり作成システムを実現する。