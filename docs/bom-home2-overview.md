# BOM Home2 UI Pattern - 概要

## 概要

BOM Home2は、製造業向けの部品表（Bill of Materials）管理システムのUIパターンです。製品の階層構造を3カラムレイアウトで効率的に閲覧・管理できるインターフェースを提供します。

## 想定ユーザー

### 主要ターゲット
- **設計エンジニア**: 製品構成の詳細確認、図面・帳票の閲覧
- **製造管理者**: 部品構成の把握、仕様情報の参照
- **品質管理担当者**: 検査成績書や仕様書の確認
- **プロジェクトマネージャー**: 製品全体の構成管理

### ユースケース
1. 複数の製品BOM間を素早く切り替えて比較
2. 階層構造を辿りながら特定部品を検索
3. 部品の詳細情報（重量、材質、圧力仕様など）を確認
4. 関連する図面や帳票のプレビュー・参照
5. 製品階層全体を俯瞰しながら詳細を確認

## 主な機能

### 1. 製品リストサイドバー（左パネル）
- 全製品の一覧表示
- 製品名による検索機能
- 製品の素早い切り替え

### 2. BOMツリーパネル（中央パネル）
- 階層構造の視覚的な表示
- 展開/折りたたみ機能
- テキスト検索による絞り込み
- タイプフィルター（製品/Assy/SubAssy/LeafProduct）
- フィルタ外アイテムの半透明表示（構造把握を維持）
- シーケンス番号/リビジョン番号の表示

### 3. 詳細パネル（右パネル）
#### Directoryノード（製品/Assy/SubAssy）
- **基本情報**: 製品コード、重量、材質、最大圧力、流量など
- **カスタム情報**: プロジェクト固有の追加項目
- **システム情報**: 作成者、更新者、作成日、更新日
- **帳票・図面ギャラリー**: 直下の文書と図面のプレビュー表示（レスポンシブ）

#### LeafProductノード（末端部品）
- **基本情報**: 部品コード、リビジョン、図面番号
- **カスタム情報**: カスタム項目の値
- **システム情報**: メタデータ

### 4. レスポンシブ対応
- **Container Queries使用**: パネル幅に応じてレイアウトが変化
  - メタデータ: 600px以下で2列、600px以上で3列
  - ギャラリー: 600px以下でアイコン表示、600px以上で画像プレビュー（2列）
- **リサイザブルレイアウト**: 中央と右パネルの境界をドラッグで調整可能

## レイアウト構造（ASCII図）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              Header (45px)                               │
└─────────────────────────────────────────────────────────────────────────┘
┌──────────────┬────────────────────┬──────────────────────────────────────┐
│              │                    │                                      │
│  製品リスト  │    BOMツリー       │        詳細パネル                    │
│  (280px固定) │  (リサイズ可能)    │      (リサイズ可能)                  │
│              │                    │                                      │
│ ┌──────────┐ │ ┌────────────────┐ │ ┌──────────────────────────────────┐ │
│ │  検索    │ │ │ 検索 | フィルタ│ │ │   ヘッダー (58px)                │ │
│ └──────────┘ │ └────────────────┘ │ │  [アイコン] タイトル  [詳細へ→] │ │
│              │                    │ └──────────────────────────────────┘ │
│ ┌──────────┐ │ ┌────────────────┐ │ ┌──────────────────────────────────┐ │
│ │ 製品A    │ │ │▼ 📁 製品A   #1 │ │ │ ━━ 基本情報 ━━                   │ │
│ │          │ │ │  ▼📁 Assy1  #1 │ │ │ ┌──────┬──────┬──────┐          │ │
│ ├──────────┤ │ │    ▶📁 SubA #2 │ │ │ │コード│タイプ│重量  │ (600px+: │ │
│ │ 製品B    │ │ │    📋 部品X #3 │ │ │ └──────┴──────┴──────┘  3列)    │ │
│ │  (選択)  │ │ │  📋 部品Y   #4 │ │ │                                  │ │
│ └──────────┘ │ │▼ 📁 Assy2   #2 │ │ │ ━━ カスタム情報 ━━               │ │
│              │ │  📋 部品Z   #5 │ │ │ (カスタム項目がある場合)         │ │
│   (スクロール│ │                    │ │                                  │ │
│    可能)     │ │  (スクロール可能)  │ │ ━━ システム情報 ━━               │ │
│              │ │                    │ │ ┌──────┬──────┬──────┐          │ │
│              │ │                    │ │ │作成者│更新者│作成日│          │ │
│              │ │                    │ │ └──────┴──────┴──────┘          │ │
│              │ │                    │ │                                  │ │
│              │ │                    │ │ ━━ 直下の帳票・図面ギャラリー ━━ │ │
│              │ │                    │ │ ┌─────────┬─────────┐ (600px+:  │ │
│              │ │                    │ │ │[📷]     │[📷]     │  2列+    │ │
│              │ │                    │ │ │仕様書   │見積書   │  画像)   │ │
│              │ │                    │ │ └─────────┴─────────┘          │ │
│              │ │                    │ │                                  │ │
│              │ │                    │ │  (スクロール可能)                │ │
└──────────────┴────────────────────┴──────────────────────────────────────┘
```

### パネル構成詳細

#### 左パネル（製品リストサイドバー）
```
┌────────────────┐
│   🔍 製品検索   │ ← 検索入力欄
├────────────────┤
│  産業用ポンプ   │ ← 製品項目（選択時: 青背景）
│  PRD-1000      │
├────────────────┤
│  産業用ポンプ   │ ← 製品項目（未選択: 白背景）
│  PRD-2000      │
└────────────────┘
```

#### 中央パネル（BOMツリー）
```
┌──────────────────────────┐
│ 🔍 検索  │ [全て ▼]      │ ← 検索 + タイプフィルター
├──────────────────────────┤
│ ▼ 📁 産業用ポンプPRD-1000 #1 │ ← ルート（展開）
│   ▼ 📁 ポンプ本体Assy    #1 │ ← Assy（展開）
│     ▶ 📁 駆動部SubAssy  #2 │ ← SubAssy（折りたたみ）
│     📋 シャフト         #3 │ ← LeafProduct
│   📋 ベースプレート      #4 │ ← LeafProduct
└──────────────────────────┘

フィルタ適用時（例: "Assy"のみ選択）:
┌──────────────────────────┐
│ 🔍 検索  │ [Assy ▼]      │
├──────────────────────────┤
│ ▼ 📁 産業用ポンプPRD-1000 #1 │ ← 薄いグレー（フィルタ外）
│   ▼ 📁 ポンプ本体Assy    #1 │ ← 通常表示（フィルタ合致）
│     📁 駆動部SubAssy    #2 │ ← 薄いグレー（フィルタ外）
│     📋 シャフト         #3 │ ← 薄いグレー（フィルタ外）
└──────────────────────────┘
```

#### 右パネル（詳細パネル - Directory例）
```
┌─────────────────────────────────────┐
│ 📁 ポンプ本体Assy  [詳細ページへ→]  │ ← ヘッダー（58px固定）
├─────────────────────────────────────┤
│                                     │
│ ━━ 基本情報 ━━                      │
│ ┏━━━━━━┳━━━━━━┳━━━━━━┓ (600px未満) │
│ ┃Assyコード┃タイプ┃重量  ┃  → 2列    │
│ ┃A-001  ┃Assy ┃25kg ┃           │
│ ┗━━━━━━┻━━━━━━┻━━━━━━┛           │
│ ┏━━━━━━┳━━━━━━┳━━━━━━┓ (600px以上) │
│ ┃材質   ┃最大圧力┃流量  ┃  → 3列    │
│ ┃SUS304┃1.5MPa┃100L/m┃           │
│ ┗━━━━━━┻━━━━━━┻━━━━━━┛           │
│                                     │
│ ━━ システム情報 ━━                  │
│ ┏━━━━━━┳━━━━━━┳━━━━━━┓           │
│ ┃作成者 ┃更新者 ┃作成日┃           │
│ ┃田中   ┃佐藤   ┃2024/1/15┃       │
│ ┗━━━━━━┻━━━━━━┻━━━━━━┛           │
│                                     │
│ ━━ 直下の帳票・図面ギャラリー ━━    │
│ ┌────────────┐ (600px未満)        │
│ │📄 製品仕様書│  → アイコン+1列    │
│ │v2          │                    │
│ └────────────┘                    │
│                                     │
│ ┌──────────┬──────────┐ (600px以上)│
│ │[画像128px]│[画像128px]│ → 画像+2列│
│ │製品仕様書  │見積書     │          │
│ │v2         │v1         │          │
│ └──────────┴──────────┘          │
└─────────────────────────────────────┘
```

## 技術スタック

- **フレームワーク**: Next.js 15.3.4 (App Router)
- **言語**: TypeScript
- **UI**: React
- **スタイリング**: Tailwind CSS
  - Container Queries (`@container`)を使用
- **コンポーネントライブラリ**: shadcn/ui
  - Select, Button, ScrollArea
- **レイアウト**: カスタムResizableLayout

## ファイル構成

```
src/page-components/bom/home2/
├── ui/
│   ├── Home2Page.tsx                    # メインページ（3カラムレイアウト）
│   ├── ProductListSidebar.tsx           # 左: 製品リスト
│   ├── BomTreePanel.tsx                 # 中央: BOMツリー
│   ├── DetailPanel.tsx                  # 右: 詳細パネル（コンテナ）
│   └── components/
│       ├── DetailHeader.tsx             # 詳細ヘッダー
│       ├── DirectoryDetail.tsx          # Directory詳細表示
│       ├── LeafProductDetail.tsx        # LeafProduct詳細表示
│       ├── MetadataPanel.tsx            # メタデータ表示
│       └── GalleryView.tsx              # 帳票・図面ギャラリー
└── lib/
    └── home2ResizableLayoutConfig.ts    # リサイズ設定
```

## データ構造

### BomNode (Union型)
```typescript
type BomNode = Directory | LeafProduct | DocumentNode
```

### Directory（製品/Assy/SubAssy）
- 階層構造の中間ノード
- 子要素（children）を持つ
- 帳票（documents）を持つ場合あり
- カスタム項目（重量、材質など）

### LeafProduct（末端部品）
- 階層の末端
- 必須で図面（drawings）を持つ
- 文書（documents）を持つ場合あり
- リビジョン管理

### DirectoryDocument（帳票）
- バージョン管理
- プレビュー画像URL
- カスタム項目（承認者、承認日など）

## デザインの特徴

### 1. 一貫性のあるヘッダー高さ
- 3つのパネルすべてで検索窓・ヘッダーの高さを統一（58px）
- `border-b`の位置が揃い、視覚的に整った印象

### 2. コンパクトなメタデータ表示
- 適度な余白（`space-y-6`, `gap-x-4 gap-y-3`）
- 必須項目には赤い`*`マーク
- フォームフィールドは薄いボーダー+白背景

### 3. インテリジェントなフィルタリング
- フィルタ外のノードは**非表示ではなく半透明表示**
- 階層構造を崩さず、コンテキストを維持
- 検索にマッチしない場合も同様に半透明化

### 4. レスポンシブギャラリー
- **狭い時**: アイコン + 1列
- **広い時（600px以上）**: 画像プレビュー（128px × 128px）+ 2列
- 画像読み込みエラー時は自動的に非表示

### 5. Container Queries活用
- パネル幅に応じてレイアウトが変化
- ビューポートではなくコンテナ基準
- リサイザブルパネルとの相性が良い

## 使用例

### 製品構成の確認フロー
1. 左パネルで製品を選択（例: 産業用ポンプPRD-1000）
2. 中央パネルでツリーを展開し、目的のAssyを探す
3. 検索窓で部品コードを入力して絞り込み
4. 見つけた部品をクリック
5. 右パネルで詳細情報を確認
6. ギャラリーから関連図面をプレビュー

### タイプフィルター活用
- 「Assy」のみ選択 → 組立品のみハイライト表示
- 「LeafProduct」のみ選択 → 末端部品のみハイライト表示
- その他は薄く表示され、構造は維持される

## 今後の拡張性

### 予定される機能
- 詳細ページへの遷移（`onNavigateToDetail`実装）
- ギャラリーアイテムクリック時の詳細表示
- ドキュメントノードの表示対応（現在は非表示）
- カスタム項目の動的追加・編集
- エクスポート機能（CSV、PDF等）

### 拡張ポイント
- `CustomItemValue`による柔軟なメタデータ対応
- `DrawingFile`と`DirectoryDocument`の統合表示
- リビジョン管理機能の強化
- ユーザー権限による表示制御

## まとめ

BOM Home2は、複雑な製品階層を直感的に操作できる3カラムレイアウトUIです。レスポンシブデザインとインテリジェントなフィルタリングにより、狭い画面でも広い画面でも快適な操作体験を提供します。製造業における部品表管理のスタンダードなUIパターンとして設計されています。
