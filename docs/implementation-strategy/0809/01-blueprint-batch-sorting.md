# 図面一括仕分け機能要件

## 概要
中小製造業の事務員が、サプライヤーからの大量注文（~100枚）を案件単位に効率的に仕分け・登録する機能。

## ペルソナ
- **役職**: 中小企業製造業の事務員
- **業務**: サプライヤーからの図面を案件別に管理・登録
- **課題**: 大量図面（100枚程度）を複数案件に効率的に振り分ける必要
- **制約**: 納期や仕様が異なるため案件単位での管理が必須

## 画面レイアウト

```
┌─────────────────────────────────────────────────┬─────────────────┐
│ ヘッダー（ビューモード切替、選択操作、一括操作） │                 │
├─────────────────────────────────────────────────┤                 │
│                                                 │   案件ボックス   │
│            図面ギャラリー（左2/4）               │    エリア       │
│                                                 │   （右1/4）     │
│ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐                 │                 │
│ │図面│ │図面│ │図面│ │図面│ │+  │                 │ ┌─────────────┐ │
│ │ A │ │ B │ │ C │ │ D │ │Add│                 │ │ ここにドロップ │ │
│ └───┘ └───┘ └───┘ └───┘ └───┘                 │ │ → 新案件作成 │ │
│ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐                 │ └─────────────┘ │
│ │図面│ │図面│ │図面│ │図面│ │図面│                 │ ┌─────────────┐ │
│ │ E │ │ F │ │ G │ │ H │ │ I │                 │ │   案件 1    │ │
│ └───┘ └───┘ └───┘ └───┘ └───┘                 │ │ [図面A,B,C] │ │
│        ・・・（スクロール可能）                 │ └─────────────┘ │
│                                                 │ ┌─────────────┐ │
│                                                 │ │   案件 2    │ │
│                                                 │ │ [図面D,E]   │ │
│                                                 │ └─────────────┘ │
│                                                 │       ...       │
│                                                 │ ┌─────────────┐ │
│                                                 │ │  一括登録   │ │
│                                                 │ │   ボタン    │ │
│                                                 │ └─────────────┘ │
└─────────────────────────────────────────────────┴─────────────────┘
```

### ドロップボックスの動作パターン

```
初期状態:
┌─────────────┐
│ ここにドロップ │  ← 最上部に固定のドロップゾーン
│ → 新案件作成 │
└─────────────┘

第1回ドロップ後:
┌─────────────┐
│ ここにドロップ │  ← 常に最上部に表示
│ → 新案件作成 │
└─────────────┘
┌─────────────┐
│   案件 1    │  ← 新しく作成された案件ボックス
│ [図面A,B,C] │
└─────────────┘

第2回ドロップ後:
┌─────────────┐
│ ここにドロップ │  ← 常に最上部に表示
│ → 新案件作成 │
└─────────────┘
┌─────────────┐
│   案件 2    │  ← 最新の案件が上に挿入
│ [図面D,E]   │
└─────────────┘
┌─────────────┐
│   案件 1    │  ← 既存案件は下にシフト
│ [図面A,B,C] │
└─────────────┘
```

## 詳細ユーザーフロー

### Phase 1: 図面アップロード・整理
1. **大量アップロード**
   - ドラッグ&ドロップで100枚程度の図面を一括アップロード
   - 対応形式: PDF, DWG, STEP, IGS, 画像ファイル
   
2. **図面整理**
   - 同一案件と思われる図面をスタック機能で重ねる
   - 明らかに不要な図面は削除
   - 詳細確認が必要な図面は拡大表示

### Phase 2: 案件仕分け作業
3. **新規案件作成**
   - 左側で同一案件の図面（スタック＋単体）を選択
   - 右側最上部の「ここにドロップ → 新案件作成」ボックスにドラッグ&ドロップ
   - 新しい案件ボックスが自動生成され、最上部ドロップゾーンの下に追加
   - 案件名は自動で「案件1」「案件2」と連番付与

4. **案件への図面追加**
   - 既存の案件ボックスに直接図面をドラッグ&ドロップで追加可能
   - 案件ボックス間での図面移動も可能
   - 案件名の手動編集・変更が可能

5. **ドロップゾーンの動作**
   - 最上部のドロップゾーンは常に固定表示
   - 新案件作成時は既存案件が下にシフト（LIFO: Last In, First Out）
   - 各案件ボックスは個別のドロップターゲットとしても機能

### Phase 3: 一括登録
6. **最終確認・登録**
   - 右側パネル下部の「一括登録」ボタンをクリック
   - 全案件を同時に正式登録
   - 案件管理システムに反映

## 技術要件

### UI/UX要件
- **ドラッグ&ドロップ**: HTML5 Drag API活用
- **レスポンシブ**: 大画面での作業効率を重視
- **リアルタイム**: 操作結果の即座な反映
- **視覚的フィードバック**: ドラッグ中のハイライト表示

### 機能要件
- **状態管理**: 図面の選択状態、案件ボックスの状態
- **データ永続化**: SessionStorage/LocalStorageでの一時保存
- **バリデーション**: 案件作成時の必須項目チェック
- **エラーハンドリング**: アップロード失敗、移動エラーの処理

### パフォーマンス要件
- **大量データ対応**: 100枚の図面表示でもスムーズな操作
- **仮想スクロール**: 大量アイテムの効率的な描画
- **プレビュー最適化**: 画像の遅延読み込み

## 期待効果
1. **作業時間短縮**: 個別登録から一括処理へ（推定70%削減）
2. **ミス削減**: 視覚的な仕分けによる分類ミス防止
3. **業務標準化**: 統一されたワークフローの確立
4. **スケーラビリティ**: 図面数増加にも対応可能な設計