# AIチャットボット実装戦略 - パターン04（大型モーダルチャット）

## 要件概要
- 浮遊チャットボタンクリックで大型モーダル表示
- モーダルサイズ: 95vh × 95vw（画面のほぼ全体）
- 01・02パターンの派生として、より集中的な対話体験を提供
- デスクトップでの詳細な作業・相談に最適化

## 技術的実装戦略

### 1. アーキテクチャ設計

#### コンポーネント構成
```
src/components/feature/blueprint-detail/04/
├── ChatButton.tsx              # 浮動チャットボタン（01・02と同様）
├── LargeModalChat.tsx          # 大型モーダルチャット
├── ChatMessage.tsx             # メッセージコンポーネント（01から流用）
├── ChatInput.tsx               # 入力エリア（01から流用）
├── ChatSidebar.tsx             # モーダル内サイドバー（新規）
├── types.ts                    # 型定義
└── index.tsx                   # メインコンポーネント
```

#### 設計思想
- **最大化された対話空間**: 95vh×95vwで圧倒的な作業領域
- **デュアルパネル**: 左チャット・右図面プレビュー
- **集中モード**: 作業の邪魔にならない大画面体験
- **リッチ機能**: ファイル共有、画面分割、複数話題管理

### 2. モーダル設計

#### LargeModalChat仕様
```typescript
interface LargeModalChatProps {
  isOpen: boolean;
  onClose: () => void;
  messages: Message[];
  onSendMessage: (message: string) => void;
  onQuickAction?: (action: string) => void;
  isLoading: boolean;
}
```

#### レイアウト構成（95vh × 95vw）
```
┌─ Large Modal (95vh × 95vw) ────────────────────────────────┐
│ ┌─ Header (60px) ─────────────────────────────────────┐   │
│ │ [AI Assistant]               [最小化] [最大化] [×]  │   │
│ └─────────────────────────────────────────────────────┘   │
│ ┌─ Content Area (calc(95vh - 60px)) ─────────────────┐   │
│ │ ┌─ Chat Area (70%) ─┐ ┌─ Sidebar (30%) ──────────┐ │   │
│ │ │                  │ │ ┌─ Blueprint Preview ──┐ │ │   │
│ │ │ [Messages Area]  │ │ │                    │ │ │   │
│ │ │                  │ │ │ [Mini Blueprint]   │ │ │   │
│ │ │                  │ │ │                    │ │ │   │
│ │ │                  │ │ └────────────────────┘ │ │   │
│ │ │                  │ │                        │ │   │
│ │ │                  │ │ ┌─ Quick Actions ────┐ │ │   │
│ │ │                  │ │ │ [図面操作]         │ │ │   │
│ │ │                  │ │ │ [ファイル共有]     │ │ │   │
│ │ └──────────────────┘ │ │ [履歴管理]         │ │ │   │
│ │ ┌─ Input (80px) ───┐ │ └────────────────────┘ │ │   │
│ │ │ [+] [Input] [送信] │ │                        │ │   │
│ │ └──────────────────┘ └────────────────────────┘ │   │
│ └─────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────┘
```

### 3. UX設計

#### 画面構成
- **左側70%**: チャットエリア（メッセージ + 入力）
- **右側30%**: サイドバー（図面プレビュー + クイックアクション）
- **ヘッダー**: タイトル + ウィンドウ操作ボタン

#### アニメーション
- **開く**: 中央からスケールアップ + フェードイン（0.4s）
- **閉じる**: スケールダウン + フェードアウト（0.3s）
- **背景**: 半透明ブラック（backdrop-blur効果）

### 4. 機能仕様

#### 基本機能
- **大画面チャット**: 01のチャット機能をそのまま拡張
- **図面プレビュー**: 右側に現在の図面を小さく表示
- **クイックアクション**: サイドバーに主要操作を配置
- **ウィンドウ操作**: 最小化、最大化、閉じる

#### 拡張機能
- **画面分割**: チャット領域の比率変更
- **図面同期**: チャット内容と図面の連動表示
- **履歴管理**: 過去の会話セッション一覧
- **ファイル共有**: ドラッグ&ドロップでファイル添付

### 5. レスポンシブ対応

#### デバイス別調整
```typescript
// デスクトップ（>1024px）
const desktopSize = { width: '95vw', height: '95vh' };

// タブレット（768-1024px）  
const tabletSize = { width: '90vw', height: '90vh' };

// モバイル（<768px）
const mobileSize = { width: '100vw', height: '100vh' }; // フルスクリーン
```

#### レイアウト調整
- **デスクトップ**: デュアルパネル（70% + 30%）
- **タブレット**: デュアルパネル（60% + 40%）
- **モバイル**: シングルパネル + タブ切り替え

### 6. パフォーマンス最適化

#### 最適化ポイント
- **仮想スクロール**: 大量メッセージの効率的表示
- **画像遅延読み込み**: 図面プレビューの最適化
- **メモリ管理**: モーダル閉じ時のクリーンアップ
- **キーボードショートカット**: Ctrl+Enter送信、Esc閉じる

### 7. アクセシビリティ

#### 対応項目
- **フォーカストラップ**: モーダル内でのタブ移動制御
- **ESCキー**: モーダルを閉じる
- **ARIA属性**: スクリーンリーダー対応
- **キーボードナビゲーション**: 全機能をキーボードで操作可能

### 8. 他パターンとの差別化

#### パターン比較
- **01（サイドパネル）**: 基本的、邪魔にならない
- **02（浮遊モーダル）**: 自由度高い、中サイズ
- **03（注釈連動）**: 革新的、空間認識
- **04（大型モーダル）**: **集中的、作業特化**

#### 04の特徴
- **最大作業領域**: 95%画面占有で圧倒的な作業空間
- **デュアルパネル**: チャット + 図面プレビューの効率的配置
- **集中モード**: 外部要素を遮断した没入体験
- **高機能**: ファイル共有、履歴管理等のリッチ機能

### 9. 実装優先度

#### Phase 1: 基本機能
1. 大型モーダル表示
2. デュアルパネルレイアウト
3. 基本チャット機能

#### Phase 2: 拡張機能
1. 図面プレビュー連動
2. クイックアクション
3. ファイル共有機能

#### Phase 3: 最適化
1. パフォーマンス改善
2. アクセシビリティ強化
3. キーボードショートカット

### 10. 技術的課題と解決策

#### 主要課題
1. **大画面でのパフォーマンス**
   - 解決: 仮想スクロール、コンポーネント最適化
2. **レスポンシブ対応**
   - 解決: デバイス別レイアウト切り替え
3. **モーダルの重さ**
   - 解決: 遅延ロード、メモリ管理

#### 実装上の注意点
- z-indexの適切な管理
- ボディスクロール無効化
- フォーカス管理の徹底
- メモリリークの防止

この戦略により、作業効率を最大化する大型モーダルチャットを実現し、複雑な図面相談や詳細な作業指示に最適な環境を提供できます。