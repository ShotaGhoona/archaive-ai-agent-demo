# 02-テクノロジー概要（Tech Overview）

## 技術スタック

### フロントエンド
- **React 19** + **TypeScript** - 型安全なコンポーネント開発
- **Tailwind CSS** - 高速スタイリング、レスポンシブ対応
- **react-markdown** - AIレスポンスのマークダウンレンダリング
- **Lucide React** - 軽量アイコンライブラリ

### バックエンド
- **Next.js API Routes** - サーバーサイドロジック
- **OpenAI API (gpt-4o-mini)** - AI エンジン
- **Vision API** - 図面画像解析（見積もりエージェント用）

## アーキテクチャパターン

### 設定駆動型設計（Configuration-Driven Architecture）
```typescript
// agentConfigs.ts - エージェントの動作をすべて設定で制御
export const availableAgents = {
  general: {
    id: 'general',
    name: 'なんでもAI',
    icon: MessageCircle,
    color: '#3b82f6',
    quickActions: [...] // UI動作も設定で制御
  }
}
```

### 共有コンポーネント戦略
- **ChatMessage.tsx** - マークダウン対応メッセージ表示（全エージェント共通）
- **ChatInput.tsx** - エージェント固有クイックアクション統合
- **Layout Components** - 3種類のレイアウト（フローティング/サイドバー/フルページ）

### クラスベースエージェント（バックエンド）
```typescript
// BaseAgent - 共通機能（バリデーション、エラーハンドリング、ログ）
// GeneralAgent extends BaseAgent - 一般相談特化
// EstimateAgent extends BaseAgent - 見積もり特化（画像解析対応）
```

## 主要技術決定事項

### なぜ設定駆動型なのか
- 新エージェント追加時のコード重複を99%削減
- 非エンジニアでもエージェント設定変更が可能
- A/Bテストやユーザーカスタマイズが容易

### なぜ共有コンポーネントなのか
- 開発速度の向上（新エージェント開発時間 80%短縮）
- UI一貫性の担保
- バグ修正・機能追加の影響範囲最小化

### なぜOpenAI gpt-4o-miniなのか
- コストパフォーマンス最適（gpt-4比で1/10のコスト）
- 製造業特化プロンプトで十分な精度
- Vision API対応で図面解析が可能

## パフォーマンス最適化

### フロントエンド
- **動的インポート** - エージェント別コード分割
- **React.memo** - 不要な再レンダリング防止
- **仮想スクロール** - 大量メッセージ対応（将来拡張）

### バックエンド
- **レスポンスキャッシュ** - 類似質問の高速応答
- **プロンプト最適化** - トークン数削減によるコスト・速度改善
- **並行処理** - 複数エージェント同時利用対応

## セキュリティ・品質保証

### データ保護
- **API キー保護** - 環境変数での管理
- **リクエスト検証** - 入力サニタイゼーション
- **レート制限** - API濫用防止

### エラーハンドリング
- **段階的エラー処理** - ユーザーフレンドリーなエラーメッセージ
- **ログ収集** - 問題の早期発見・対応
- **フォールバック機能** - AI応答失敗時の代替処理