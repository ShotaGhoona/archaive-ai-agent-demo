# 3段階テーブルソート機能の実装

## 概要

テーブルのソート機能を従来の2段階（昇順⇄降順）から3段階（昇順→降順→リセット）に拡張しました。

## 変更内容

### 修正前（2段階ソート）
- **初回クリック**: 昇順ソート
- **2回目クリック**: 降順ソート  
- **3回目クリック**: 昇順ソート（ループ）

### 修正後（3段階ソート）
- **初回クリック**: 昇順ソート
- **2回目クリック**: 降順ソート
- **3回目クリック**: リセット（ソートなし・元の順序）
- **4回目クリック**: 昇順ソート（最初に戻る）

## 実装詳細

### 修正されたファイル
- `src/shared/basic-data-table/lib/useTableSort.ts`

### コード変更

```typescript
// 修正前
const handleSort = useCallback((field: string) => {
  let direction: 'asc' | 'desc' = 'asc';
  
  if (sortConfig?.field === field && sortConfig?.direction === 'asc') {
    direction = 'desc';
  }
  
  setSortConfig({ field, direction });
}, [sortConfig]);

// 修正後
const handleSort = useCallback((field: string) => {
  // 3段階のソート: なし → 昇順 → 降順 → なし（リセット）
  if (!sortConfig || sortConfig.field !== field) {
    // 新しいフィールドでソート開始（昇順）
    setSortConfig({ field, direction: 'asc' });
  } else if (sortConfig.direction === 'asc') {
    // 昇順 → 降順
    setSortConfig({ field, direction: 'desc' });
  } else {
    // 降順 → リセット（ソートなし）
    setSortConfig(null);
  }
}, [sortConfig]);
```

## ソート状態とアイコンの対応

| 状態 | アイコン | 説明 |
|------|----------|------|
| ソートなし | `ChevronsUpDown` (⇅) | 初期状態・リセット後 |
| 昇順ソート | `ChevronUp` (↑) | 小さい値から大きい値へ |
| 降順ソート | `ChevronDown` (↓) | 大きい値から小さい値へ |

## ユーザー体験の改善点

### 1. 元の順序への復帰
- データの元の並び順（JSONファイルの順序、データベースの順序など）に戻すことが可能
- 複数のソートを試した後、簡単にリセットできる

### 2. 直感的な操作
- 一般的なソート機能の慣例に従った3段階サイクル
- Excel、Google Sheetsなどと同様の操作感

### 3. 視覚的なフィードバック
- アイコンの色と形で現在の状態が明確
- `text-blue-600` でアクティブなソート状態を強調
- `text-gray-400` でニュートラル状態を表示

## 動作パターンの例

### 同一列での連続クリック
```
初期状態: [A, B, C, D] (ソートなし・⇅)
    ↓
1回目: [A, B, C, D] (昇順・↑)
    ↓  
2回目: [D, C, B, A] (降順・↓)
    ↓
3回目: [A, B, C, D] (リセット・⇅)
    ↓
4回目: [A, B, C, D] (昇順・↑) ←サイクル
```

### 異なる列のクリック
```
列Aをクリック: [列Aで昇順ソート] (列A:↑, 他の列:⇅)
列Bをクリック: [列Bで昇順ソート] (列B:↑, 他の列:⇅)
```

## 技術的考慮事項

### 状態管理
- `sortConfig` が `null` の場合：ソートなし状態
- `sortConfig` が `{field: string, direction: 'asc'|'desc'}` の場合：アクティブソート状態

### データの処理
- `getSortedData()` 関数は `sortConfig` が `null` の場合、元のデータをそのまま返す
- ソート処理は元のデータを変更せず、新しい配列を返す（イミュータブル）

### パフォーマンス
- `useCallback` によるメモ化でレンダリング最適化
- 大量データでもソート切り替えが高速

## 対象テーブル

この変更は以下の全テーブルに適用されます：

- ✅ Blueprint テーブル
- ✅ Customer テーブル  
- ✅ Project テーブル
- ✅ 今後作成される全てのBasicDataTableベースのテーブル

## テスト項目

実装後の確認事項：

1. **基本動作**
   - [ ] 各列で3段階ソートが正常動作
   - [ ] リセット後に元の順序に戻る
   - [ ] アイコンが状態に応じて正しく表示

2. **データ型別ソート**
   - [ ] 文字列ソート（日本語対応）
   - [ ] 数値ソート
   - [ ] 日付ソート

3. **複数列の操作**
   - [ ] 異なる列をクリックした時の状態切り替え
   - [ ] 前の列のソート状態がリセットされる

4. **ページネーションとの連携**
   - [ ] ソート後のページネーション動作
   - [ ] ページ切り替え後のソート状態維持

5. **レスポンシブ対応**
   - [ ] モバイル環境でのタップ操作
   - [ ] 小画面でのアイコン表示

## ユーザーガイド

### 基本的な使い方

1. **列ヘッダーをクリック**してソートを開始
2. **もう一度クリック**で逆順ソート
3. **3回目のクリック**で元の順序に戻る

### 視覚的な手がかり

- **⇅ (グレー)**: ソートなし
- **↑ (青)**: 昇順ソート中  
- **↓ (青)**: 降順ソート中

これにより、ユーザーはより柔軟で直感的なデータ操作が可能になります。