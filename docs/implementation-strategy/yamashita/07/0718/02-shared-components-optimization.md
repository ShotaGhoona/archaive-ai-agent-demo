# 共有コンポーネント最適化戦略

## 現状分析

現在のエージェント実装では**60-70%のコード重複**が発生している：

### 重複パターン

- **自動スクロール**: 全エージェントで同一ロジック
- **メッセージレイアウト**: 基本構造が完全一致
- **フォーム処理**: 送信・キー処理が重複
- **ローディング表示**: TypingIndicator使用方法が同一

### エージェント別差分

- **General**: シンプルなチャット
- **Estimate**: ファイルアップロード機能
- **Inquiry**: FAQ表示・フィードバック機能
- **Process**: ワークフロー可視化

## 最適化戦略

### 1. カスタムフック抽出 (即効性★★★)

```typescript
// useAutoScroll - 自動スクロール共通化
// useMessageInput - フォーム処理共通化
// useAgentState - エージェント状態管理共通化
```

### 2. コンポーネント合成パターン (効果★★★)

```typescript
// BaseMessage - レンダープロップスで差分吸収
// AgentContentWrapper - 共通構造 + エージェント固有部分
// ConfigurableInput - 設定による動作変更
```

### 3. エージェント設定駆動 (保守性★★★)

```typescript
interface AgentConfig {
  messageRenderer?: Component;
  welcomeComponent?: Component;
  quickActions: QuickAction[];
  features: AgentFeatures;
}
```

## 実装優先度

### High Priority（即座に70%削減）

1. **自動スクロールフック化** - 全エージェント共通
2. **ベースメッセージ化** - レンダープロップス導入
3. **フォーム処理フック化** - 入力処理統一

### Medium Priority（さらに15%削減）

4. **コンテンツラッパー統一** - 構造共通化
5. **設定駆動インプット** - 動的機能切り替え

### Low Priority（保守性向上）

6. **エージェントレジストリ** - 動的設定システム

## 期待効果

- **開発効率**: 新エージェント追加が80%高速化
- **保守性**: バグ修正が一箇所で全エージェントに反映
- **一貫性**: 自動スクロール等の動作が全エージェントで統一
- **テスト**: 共通ロジックのテストカバレッジ向上

## 実装方針

エージェント固有の特色を保ちながら、共通機能は徹底的に抽象化。レンダープロップスと設定駆動で差分を表現し、型安全性を確保する。
